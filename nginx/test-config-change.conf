# 配置变更测试文件
# 用于测试智能CI/CD流水线的配置变更检测

# 预期结果: 触发 config-deploy 模式
# 验证点: 配置变更检测，配置验证任务

server {
    listen 80;
    server_name test-config-change.local;
    
    # 测试配置变更检测
    location /test-config {
        add_header Content-Type text/plain;
        return 200 "配置变更测试成功 - CI/CD检测到配置变更";
    }
    
    # 健康检查端点
    location /health {
        add_header Content-Type application/json;
        return 200 '{"status":"healthy","config":"test-config-change","timestamp":"$(date)"}';
    }
    
    # 测试静态文件服务
    location /static/ {
        alias /var/www/html/static/;
        expires 1h;
        add_header Cache-Control "public, immutable";
    }
    
    # 测试代理配置
    location /api/ {
        proxy_pass http://localhost:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# 测试SSL配置
server {
    listen 443 ssl;
    server_name test-config-change.local;
    
    # SSL证书配置（测试用）
    ssl_certificate /etc/ssl/certs/test-cert.pem;
    ssl_certificate_key /etc/ssl/private/test-key.pem;
    
    # SSL安全配置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    location / {
        add_header Content-Type text/plain;
        return 200 "HTTPS配置变更测试成功";
    }
}