# ç»Ÿä¸€è®¤è¯ç³»ç»Ÿä¸Dev-Teamé›†æˆå®æ–½è®¡åˆ’

## ğŸ¯ é›†æˆç›®æ ‡

å°†ç»Ÿä¸€è®¤è¯ç³»ç»Ÿä¸ç°æœ‰çš„Dev-Teamç®¡ç†ç³»ç»Ÿå®Œç¾ç»“åˆï¼Œå®ç°ï¼š
1. **ç»Ÿä¸€ç”¨æˆ·è®¤è¯**: æ‰€æœ‰æœåŠ¡ä½¿ç”¨ç»Ÿä¸€çš„JWTè®¤è¯
2. **è§’è‰²æƒé™ç»Ÿä¸€**: 7ç§Dev-Teamè§’è‰²ä¸ç»Ÿä¸€è®¤è¯ç³»ç»Ÿè§’è‰²æ˜ å°„
3. **æƒé™ç®¡ç†ç»Ÿä¸€**: ç»†ç²’åº¦æƒé™æ§åˆ¶ä¸æ ‡å‡†åŒ–RBACç»“åˆ
4. **æ“ä½œå®¡è®¡ç»Ÿä¸€**: å®Œæ•´çš„æ“ä½œæ—¥å¿—å’Œè®¿é—®è®°å½•

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### é›†æˆæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ (8207)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ç”¨æˆ·è®¤è¯ä¸­å¿ƒ   â”‚  â”‚   æƒé™ç®¡ç†ä¸­å¿ƒ   â”‚  â”‚  è§’è‰²ç®¡ç†ä¸­å¿ƒ â”‚ â”‚
â”‚  â”‚  - JWTéªŒè¯      â”‚  â”‚  - RBACæƒé™     â”‚  â”‚  - 7ç§è§’è‰²   â”‚ â”‚
â”‚  â”‚  - ç™»å½•ç®¡ç†     â”‚  â”‚  - æƒé™æ£€æŸ¥     â”‚  â”‚  - è§’è‰²æ˜ å°„   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ APIè°ƒç”¨
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Dev-TeamæœåŠ¡ (8088)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   å›¢é˜Ÿç®¡ç†      â”‚  â”‚   æƒé™æ§åˆ¶      â”‚  â”‚  æ“ä½œå®¡è®¡    â”‚ â”‚
â”‚  â”‚  - æˆå‘˜ç®¡ç†     â”‚  â”‚  - ç»†ç²’åº¦æƒé™   â”‚  â”‚  - æ“ä½œæ—¥å¿—   â”‚ â”‚
â”‚  â”‚  - è§’è‰²åˆ†é…     â”‚  â”‚  - è®¿é—®æ§åˆ¶     â”‚  â”‚  - è®¿é—®è®°å½•   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ è®¤è¯éªŒè¯
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…¶ä»–å¾®æœåŠ¡                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ User Service â”‚  â”‚ Resume Svc   â”‚  â”‚ Basic Server â”‚      â”‚
â”‚  â”‚    (8081)    â”‚  â”‚    (8082)    â”‚  â”‚    (8080)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ è§’è‰²æ˜ å°„ç­–ç•¥

### Dev-Teamè§’è‰² â†’ ç»Ÿä¸€è®¤è¯è§’è‰²æ˜ å°„

| Dev-Teamè§’è‰² | ç»Ÿä¸€è®¤è¯è§’è‰² | æƒé™çº§åˆ« | è¯´æ˜ |
|-------------|-------------|----------|------|
| `super_admin` | `super_admin` | Level 4 | æœ€é«˜æƒé™ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ |
| `system_admin` | `admin` | Level 3 | ç³»ç»Ÿç®¡ç†æƒé™ |
| `dev_lead` | `admin` | Level 3 | å¼€å‘è´Ÿè´£äººæƒé™ |
| `frontend_dev` | `user` | Level 2 | å‰ç«¯å¼€å‘æƒé™ |
| `backend_dev` | `user` | Level 2 | åç«¯å¼€å‘æƒé™ |
| `qa_engineer` | `user` | Level 2 | æµ‹è¯•å·¥ç¨‹å¸ˆæƒé™ |
| `guest` | `guest` | Level 1 | è®¿å®¢æƒé™ |

### æƒé™æ˜ å°„è¡¨

| ç»Ÿä¸€è®¤è¯æƒé™ | Dev-Teamæƒé™ | è¯´æ˜ |
|-------------|-------------|------|
| `admin:users` | `super_admin`, `system_admin` | ç”¨æˆ·ç®¡ç†æƒé™ |
| `admin:system` | `super_admin`, `system_admin` | ç³»ç»Ÿç®¡ç†æƒé™ |
| `write:all` | `super_admin`, `system_admin`, `dev_lead` | å…¨å±€å†™å…¥æƒé™ |
| `read:all` | æ‰€æœ‰è§’è‰² | å…¨å±€è¯»å–æƒé™ |
| `write:own` | æ‰€æœ‰å¼€å‘è§’è‰² | ä¸ªäººå†…å®¹ç®¡ç† |
| `read:own` | æ‰€æœ‰è§’è‰² | ä¸ªäººå†…å®¹è¯»å– |

## ğŸ“‹ å®æ–½æ­¥éª¤

### é˜¶æ®µ1: ç»Ÿä¸€è®¤è¯ç³»ç»Ÿéƒ¨ç½² (1-2å¤©) âœ… **å·²å®Œæˆ**

#### 1.1 æ•°æ®åº“è¿ç§» âœ… **å·²å®Œæˆ**
```bash
# æ‰§è¡Œç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ•°æ®åº“è¿ç§»
mysql -u root jobfirst < scripts/migrate_auth_system.sql

# éªŒè¯è¿ç§»ç»“æœ
mysql -u root -e "USE jobfirst; SHOW TABLES LIKE '%auth%';"
```
**ç»“æœ**: æˆåŠŸåˆ›å»ºaccess_logsè¡¨ï¼Œè¿ç§»ç°æœ‰ç”¨æˆ·æ•°æ®ï¼Œåˆ†é…æƒé™

#### 1.2 ç»Ÿä¸€è®¤è¯æœåŠ¡éƒ¨ç½² âœ… **å·²å®Œæˆ**
```bash
# ç¼–è¯‘ç»Ÿä¸€è®¤è¯æœåŠ¡
cd backend/cmd/unified-auth
go build -o unified-auth main.go

# å¯åŠ¨ç»Ÿä¸€è®¤è¯æœåŠ¡
export JWT_SECRET="jobfirst-unified-auth-secret-key-2024"
export DATABASE_URL="root:@tcp(localhost:3306)/jobfirst?charset=utf8mb4&parseTime=True&loc=Local"
export AUTH_SERVICE_PORT="8207"
./unified-auth
```
**ç»“æœ**: æœåŠ¡æˆåŠŸå¯åŠ¨åœ¨ç«¯å£8207ï¼Œæ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ

#### 1.3 éªŒè¯ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ âœ… **å·²å®Œæˆ**
```bash
# æµ‹è¯•ç™»å½•API
curl -X POST http://localhost:8207/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password"}'

# æµ‹è¯•è§’è‰²API
curl -X GET http://localhost:8207/api/v1/auth/roles

# æµ‹è¯•æƒé™API
curl -X GET "http://localhost:8207/api/v1/auth/permissions?role=super_admin"
```
**ç»“æœ**: æ‰€æœ‰APIæµ‹è¯•é€šè¿‡ï¼ŒJWT tokenç”Ÿæˆæ­£å¸¸ï¼Œæƒé™ç³»ç»Ÿå·¥ä½œæ­£å¸¸

**é˜¶æ®µ1æ€»ç»“**: 
- âœ… æ•°æ®åº“è¿ç§»æˆåŠŸï¼Œç°æœ‰Dev-Teamç”¨æˆ·æ•°æ®å®Œæ•´ä¿ç•™
- âœ… ç»Ÿä¸€è®¤è¯æœåŠ¡ç¼–è¯‘å¹¶å¯åŠ¨æˆåŠŸ
- âœ… æ‰€æœ‰APIç«¯ç‚¹éªŒè¯é€šè¿‡
- âœ… JWTè®¤è¯å’Œæƒé™ç®¡ç†æ­£å¸¸å·¥ä½œ
- âœ… ä¸ç°æœ‰æ•°æ®åº“è¡¨ç»“æ„å®Œç¾å…¼å®¹

### é˜¶æ®µ2: Dev-TeamæœåŠ¡é›†æˆ (2-3å¤©)

#### 2.1 ä¿®æ”¹Dev-TeamæœåŠ¡è®¤è¯é€»è¾‘
```go
// åœ¨ dev-team-service/main.go ä¸­æ·»åŠ ç»Ÿä¸€è®¤è¯å®¢æˆ·ç«¯
type UnifiedAuthClient struct {
    baseURL string
    client  *http.Client
}

func NewUnifiedAuthClient(baseURL string) *UnifiedAuthClient {
    return &UnifiedAuthClient{
        baseURL: baseURL,
        client:  &http.Client{Timeout: 10 * time.Second},
    }
}

// éªŒè¯JWT token
func (uac *UnifiedAuthClient) ValidateToken(token string) (*AuthResult, error) {
    req, _ := http.NewRequest("POST", uac.baseURL+"/api/v1/auth/validate", 
        strings.NewReader(fmt.Sprintf(`{"token":"%s"}`, token)))
    req.Header.Set("Content-Type", "application/json")
    
    resp, err := uac.client.Do(req)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()
    
    var result AuthResult
    json.NewDecoder(resp.Body).Decode(&result)
    return &result, nil
}
```

#### 2.2 æ›´æ–°Dev-Teamä¸­é—´ä»¶
```go
// ä¿®æ”¹è®¤è¯ä¸­é—´ä»¶ä½¿ç”¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ
func UnifiedAuthMiddleware(authClient *UnifiedAuthClient) gin.HandlerFunc {
    return func(c *gin.Context) {
        token := c.GetHeader("Authorization")
        if token == "" {
            c.JSON(http.StatusUnauthorized, gin.H{"error": "ç¼ºå°‘è®¤è¯token"})
            c.Abort()
            return
        }
        
        // ç§»é™¤ "Bearer " å‰ç¼€
        if strings.HasPrefix(token, "Bearer ") {
            token = token[7:]
        }
        
        // è°ƒç”¨ç»Ÿä¸€è®¤è¯ç³»ç»ŸéªŒè¯token
        authResult, err := authClient.ValidateToken(token)
        if err != nil || !authResult.Success {
            c.JSON(http.StatusUnauthorized, gin.H{"error": "æ— æ•ˆçš„è®¤è¯token"})
            c.Abort()
            return
        }
        
        // è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡
        c.Set("user_id", authResult.User.ID)
        c.Set("username", authResult.User.Username)
        c.Set("role", authResult.User.Role)
        c.Set("permissions", authResult.Permissions)
        
        c.Next()
    }
}
```

#### 2.3 æ›´æ–°Dev-Teamæƒé™æ£€æŸ¥
```go
// ä½¿ç”¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿçš„æƒé™æ£€æŸ¥
func (tm *Manager) CheckPermission(userID uint, requiredPermission string) bool {
    // è°ƒç”¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ£€æŸ¥æƒé™
    authClient := NewUnifiedAuthClient("http://localhost:8207")
    
    // è·å–ç”¨æˆ·æƒé™
    user, err := tm.GetUserByID(userID)
    if err != nil {
        return false
    }
    
    // æ£€æŸ¥æƒé™
    for _, permission := range user.Permissions {
        if permission == requiredPermission {
            return true
        }
    }
    
    return false
}
```

### é˜¶æ®µ3: æ•°æ®åŒæ­¥å’Œè¿ç§» (1-2å¤©)

#### 3.1 åˆ›å»ºæ•°æ®åŒæ­¥è„šæœ¬
```sql
-- åŒæ­¥Dev-Teamç”¨æˆ·åˆ°ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ
INSERT INTO users_new (username, email, password_hash, role, status, created_at, updated_at)
SELECT 
    u.username,
    u.email,
    u.password_hash,
    CASE 
        WHEN dtu.team_role = 'super_admin' THEN 'super_admin'
        WHEN dtu.team_role IN ('system_admin', 'dev_lead') THEN 'admin'
        WHEN dtu.team_role IN ('frontend_dev', 'backend_dev', 'qa_engineer') THEN 'user'
        ELSE 'guest'
    END as role,
    dtu.status,
    dtu.created_at,
    dtu.updated_at
FROM users u
JOIN dev_team_users dtu ON u.id = dtu.user_id
WHERE u.id NOT IN (SELECT id FROM users_new);
```

#### 3.2 æƒé™æ•°æ®è¿ç§»
```sql
-- ä¸ºDev-Teamè§’è‰²åˆ†é…æƒé™
INSERT INTO role_permissions (role, permission)
SELECT DISTINCT 
    CASE 
        WHEN dtu.team_role = 'super_admin' THEN 'super_admin'
        WHEN dtu.team_role IN ('system_admin', 'dev_lead') THEN 'admin'
        WHEN dtu.team_role IN ('frontend_dev', 'backend_dev', 'qa_engineer') THEN 'user'
        ELSE 'guest'
    END as role,
    p.name as permission
FROM dev_team_users dtu
CROSS JOIN permissions p
WHERE dtu.status = 'active';
```

### é˜¶æ®µ4: æµ‹è¯•å’ŒéªŒè¯ (1-2å¤©)

#### 4.1 é›†æˆæµ‹è¯•
```bash
# æµ‹è¯•ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ
curl -X POST http://localhost:8207/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# æµ‹è¯•Dev-TeamæœåŠ¡é›†æˆ
curl -X GET http://localhost:8088/api/v1/dev-team/admin/members \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### 4.2 ç«¯åˆ°ç«¯æµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´çš„é›†æˆæµ‹è¯•
./scripts/test_unified_auth_dev_team_integration.sh
```

## ğŸ”§ é…ç½®æ›´æ–°

### ç»Ÿä¸€è®¤è¯ç³»ç»Ÿé…ç½®
```yaml
# configs/unified-auth-config.yaml
auth:
  jwt_secret: "jobfirst-unified-auth-secret-key-2024"
  token_expiry: "24h"
  refresh_expiry: "168h"  # 7å¤©

database:
  url: "root:@tcp(localhost:3306)/jobfirst?charset=utf8mb4&parseTime=True&loc=Local"

server:
  port: 8207
  host: "0.0.0.0"

dev_team_integration:
  enabled: true
  dev_team_service_url: "http://localhost:8088"
  sync_interval: "1h"
```

### Dev-TeamæœåŠ¡é…ç½®
```yaml
# configs/dev-team-config.yaml
auth:
  unified_auth_url: "http://localhost:8207"
  token_validation_timeout: "5s"

server:
  port: 8088
  host: "0.0.0.0"

database:
  url: "root:@tcp(localhost:3306)/jobfirst?charset=utf8mb4&parseTime=True&loc=Local"
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### å¥åº·æ£€æŸ¥ç«¯ç‚¹
```bash
# ç»Ÿä¸€è®¤è¯ç³»ç»Ÿå¥åº·æ£€æŸ¥
curl http://localhost:8207/health

# Dev-TeamæœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:8088/health
```

### æ—¥å¿—ç›‘æ§
```bash
# æŸ¥çœ‹ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ—¥å¿—
tail -f logs/unified-auth.log

# æŸ¥çœ‹Dev-TeamæœåŠ¡æ—¥å¿—
tail -f logs/dev-team-service.log

# æŸ¥çœ‹é›†æˆæ—¥å¿—
mysql -u root -e "USE jobfirst; SELECT * FROM access_logs WHERE service = 'dev-team' ORDER BY created_at DESC LIMIT 10;"
```

## ğŸš€ éƒ¨ç½²è„šæœ¬

### ä¸€é”®éƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# scripts/deploy_unified_auth_dev_team.sh

set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½²ç»Ÿä¸€è®¤è¯ç³»ç»Ÿä¸Dev-Teamé›†æˆ..."

# 1. åœæ­¢ç°æœ‰æœåŠ¡
echo "ğŸ“‹ åœæ­¢ç°æœ‰æœåŠ¡..."
pkill -f "unified-auth" || true
pkill -f "dev-team-service" || true

# 2. æ•°æ®åº“è¿ç§»
echo "ğŸ“‹ æ‰§è¡Œæ•°æ®åº“è¿ç§»..."
mysql -u root jobfirst < scripts/migrate_auth_system.sql

# 3. ç¼–è¯‘æœåŠ¡
echo "ğŸ“‹ ç¼–è¯‘æœåŠ¡..."
cd backend/cmd/unified-auth && go build -o unified-auth main.go
cd ../dev-team-service && go build -o dev-team-service main.go

# 4. å¯åŠ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ
echo "ğŸ“‹ å¯åŠ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ..."
export JWT_SECRET="jobfirst-unified-auth-secret-key-2024"
export DATABASE_URL="root:@tcp(localhost:3306)/jobfirst?charset=utf8mb4&parseTime=True&loc=Local"
export AUTH_SERVICE_PORT="8207"
nohup ./unified-auth > ../../logs/unified-auth.log 2>&1 &

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 5

# 5. å¯åŠ¨Dev-TeamæœåŠ¡
echo "ğŸ“‹ å¯åŠ¨Dev-TeamæœåŠ¡..."
nohup ./dev-team-service > ../../logs/dev-team-service.log 2>&1 &

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 5

# 6. éªŒè¯éƒ¨ç½²
echo "ğŸ“‹ éªŒè¯éƒ¨ç½²..."
./scripts/test_unified_auth_dev_team_integration.sh

echo "âœ… ç»Ÿä¸€è®¤è¯ç³»ç»Ÿä¸Dev-Teamé›†æˆéƒ¨ç½²å®Œæˆï¼"
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
```go
// åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿä¸­æ·»åŠ æƒé™ç¼“å­˜
type PermissionCache struct {
    cache map[string][]string
    mutex sync.RWMutex
    ttl   time.Duration
}

func (pc *PermissionCache) GetUserPermissions(userID uint) ([]string, bool) {
    pc.mutex.RLock()
    defer pc.mutex.RUnlock()
    
    key := fmt.Sprintf("user_%d", userID)
    permissions, exists := pc.cache[key]
    return permissions, exists
}
```

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_users_role_status ON users (role, status);
CREATE INDEX idx_role_permissions_role ON role_permissions (role);
CREATE INDEX idx_access_logs_user_service ON access_logs (user_id, service, created_at);
```

## ğŸ”’ å®‰å…¨å¢å¼º

### JWTå®‰å…¨é…ç½®
```go
// å¢å¼ºJWTå®‰å…¨æ€§
type JWTSecurityConfig struct {
    SecretKey       string        `json:"secret_key"`
    TokenExpiry     time.Duration `json:"token_expiry"`
    RefreshExpiry   time.Duration `json:"refresh_expiry"`
    Issuer          string        `json:"issuer"`
    Audience        string        `json:"audience"`
    Algorithm       string        `json:"algorithm"`
    MaxRefreshCount int           `json:"max_refresh_count"`
}
```

### æƒé™éªŒè¯å¢å¼º
```go
// æ·»åŠ æƒé™éªŒè¯ä¸­é—´ä»¶
func RequirePermission(permission string) gin.HandlerFunc {
    return func(c *gin.Context) {
        userPermissions := c.GetStringSlice("permissions")
        
        hasPermission := false
        for _, perm := range userPermissions {
            if perm == permission {
                hasPermission = true
                break
            }
        }
        
        if !hasPermission {
            c.JSON(http.StatusForbidden, gin.H{"error": "æƒé™ä¸è¶³"})
            c.Abort()
            return
        }
        
        c.Next()
    }
}
```

## ğŸ“ æ”¯æŒå’Œç»´æŠ¤

### æ•…éšœæ’é™¤
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
ps aux | grep -E "(unified-auth|dev-team-service)"

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E "(8207|8088)"

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -u root -e "SELECT COUNT(*) FROM users_new;"
```

### æ›´æ–°å’Œç»´æŠ¤
```bash
# å®šæœŸæ•°æ®åŒæ­¥
./scripts/sync_dev_team_users.sh

# æƒé™æ›´æ–°
./scripts/update_role_permissions.sh

# æ—¥å¿—æ¸…ç†
./scripts/cleanup_access_logs.sh
```

---

## ğŸ¯ æ€»ç»“

è¿™ä¸ªé›†æˆæ–¹æ¡ˆå°†ï¼š

1. **ä¿æŒDev-TeamæœåŠ¡çš„ç‹¬ç«‹æ€§** - ä¸ç ´åç°æœ‰åŠŸèƒ½
2. **ç»Ÿä¸€è®¤è¯ç®¡ç†** - æ‰€æœ‰æœåŠ¡ä½¿ç”¨ç»Ÿä¸€çš„JWTè®¤è¯
3. **è§’è‰²æƒé™ç»Ÿä¸€** - 7ç§Dev-Teamè§’è‰²ä¸ç»Ÿä¸€è®¤è¯ç³»ç»Ÿå®Œç¾æ˜ å°„
4. **æ“ä½œå®¡è®¡ç»Ÿä¸€** - å®Œæ•´çš„æ“ä½œæ—¥å¿—å’Œè®¿é—®è®°å½•
5. **æ¸è¿›å¼è¿ç§»** - é£é™©æœ€å°åŒ–çš„å®æ–½ç­–ç•¥

**é¢„è®¡å®æ–½æ—¶é—´**: 5-7å¤©  
**é£é™©ç­‰çº§**: ä½  
**æ”¶ç›Š**: é«˜ - ç»Ÿä¸€çš„è®¤è¯ç®¡ç†ï¼Œæ›´å¥½çš„å®‰å…¨æ€§ï¼Œæ›´æ˜“ç»´æŠ¤

è¿™ä¸ªæ–¹æ¡ˆæ—¢ä¿æŒäº†ç°æœ‰Dev-Teamç³»ç»Ÿçš„ä¼˜åŠ¿ï¼Œåˆè§£å†³äº†ç»Ÿä¸€è®¤è¯çš„é—®é¢˜ï¼Œæ˜¯æœ€ä¼˜çš„é›†æˆç­–ç•¥ï¼
