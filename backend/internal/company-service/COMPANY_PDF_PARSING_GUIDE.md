# CompanyæœåŠ¡PDFæ–‡æ¡£è§£æä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨CompanyæœåŠ¡çš„PDFæ–‡æ¡£è§£æåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½é›†æˆäº†MinerUæœåŠ¡ï¼Œèƒ½å¤Ÿæ™ºèƒ½è§£æä¼ä¸šç›¸å…³æ–‡æ¡£å¹¶æå–ç»“æ„åŒ–ä¿¡æ¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½
- **å¤šæ ¼å¼æ”¯æŒ**: PDFã€DOCXã€DOCã€TXT
- **æ™ºèƒ½è§£æ**: ä½¿ç”¨MinerUæœåŠ¡è¿›è¡Œæ–‡æ¡£å†…å®¹æå–
- **ç»“æ„åŒ–å­˜å‚¨**: å°†è§£æç»“æœå­˜å‚¨ä¸ºç»“æ„åŒ–æ•°æ®
- **å¼‚æ­¥å¤„ç†**: æ”¯æŒå¤§æ–‡æ¡£çš„å¼‚æ­¥è§£æ
- **æƒé™æ§åˆ¶**: åŸºäºç”¨æˆ·è§’è‰²çš„è®¿é—®æ§åˆ¶
- **çŠ¶æ€è·Ÿè¸ª**: å®æ—¶è·Ÿè¸ªè§£æè¿›åº¦å’ŒçŠ¶æ€

### ğŸ“Š è§£æå†…å®¹
- **åŸºæœ¬ä¿¡æ¯**: ä¼ä¸šåç§°ã€ç®€ç§°ã€æˆç«‹å¹´ä»½ã€è§„æ¨¡ã€è¡Œä¸šã€åœ°å€ã€ç½‘ç«™
- **ä¸šåŠ¡ä¿¡æ¯**: ä¸»è¥ä¸šåŠ¡ã€äº§å“æœåŠ¡ã€ç›®æ ‡å®¢æˆ·ã€ç«äº‰ä¼˜åŠ¿
- **ç»„ç»‡ä¿¡æ¯**: ç»„ç»‡æ¶æ„ã€éƒ¨é—¨è®¾ç½®ã€äººå‘˜è§„æ¨¡ã€ç®¡ç†å±‚ä¿¡æ¯
- **è´¢åŠ¡ä¿¡æ¯**: æ³¨å†Œèµ„æœ¬ã€å¹´è¥ä¸šé¢ã€èèµ„æƒ…å†µã€ä¸Šå¸‚çŠ¶æ€

## æ¶æ„è®¾è®¡

```
CompanyæœåŠ¡ â†â†’ MinerUæœåŠ¡ â†â†’ AIæ¨¡å‹æœåŠ¡
     â†“              â†“              â†“
  æ–‡æ¡£å­˜å‚¨        æ–‡æ¡£è§£æ        æ™ºèƒ½åˆ†æ
     â†“              â†“              â†“
  ç»“æ„åŒ–æ•°æ®      è§£æç»“æœ        ä¸šåŠ¡æ´å¯Ÿ
```

## APIæ¥å£

### 1. æ–‡æ¡£ä¸Šä¼ 

**æ¥å£**: `POST /api/v1/company/documents/upload`

**è¯·æ±‚å‚æ•°**:
- `file`: ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆmultipart/form-dataï¼‰
- `company_id`: ä¼ä¸šID
- `title`: æ–‡æ¡£æ ‡é¢˜

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "success",
  "document_id": 1,
  "message": "æ–‡æ¡£ä¸Šä¼ æˆåŠŸ",
  "upload_time": "2025-09-15T10:30:00Z"
}
```

### 2. æ–‡æ¡£è§£æ

**æ¥å£**: `POST /api/v1/company/documents/{id}/parse`

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "success",
  "task_id": 1,
  "message": "è§£æä»»åŠ¡å·²åˆ›å»ºï¼Œæ­£åœ¨å¤„ç†ä¸­"
}
```

### 3. è§£æçŠ¶æ€æŸ¥è¯¢

**æ¥å£**: `GET /api/v1/company/documents/{id}/parse/status`

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "completed",
  "task_id": 1,
  "progress": 100,
  "message": "è§£æå®Œæˆ",
  "structured_data": {
    "basic_info": {
      "name": "æµ‹è¯•ç§‘æŠ€æœ‰é™å…¬å¸",
      "short_name": "æµ‹è¯•ç§‘æŠ€",
      "founded_year": 2020,
      "company_size": "51-100äºº",
      "industry": "äº’è”ç½‘/ç”µå­å•†åŠ¡",
      "location": "åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—1å·",
      "website": "https://www.testtech.com"
    },
    "business_info": {
      "main_business": "è½¯ä»¶å¼€å‘ã€æŠ€æœ¯å’¨è¯¢",
      "products": "ä¼ä¸šç®¡ç†ç³»ç»Ÿã€ç§»åŠ¨åº”ç”¨å¼€å‘",
      "target_customers": "ä¸­å°ä¼ä¸šã€æ”¿åºœæœºæ„",
      "competitive_advantage": "æŠ€æœ¯é¢†å…ˆã€æœåŠ¡ä¼˜è´¨"
    },
    "organization_info": {
      "organization_structure": "æŠ€æœ¯éƒ¨ã€å¸‚åœºéƒ¨ã€äººäº‹éƒ¨ã€è´¢åŠ¡éƒ¨",
      "departments": "ç ”å‘ä¸­å¿ƒã€é”€å”®ä¸­å¿ƒã€è¿è¥ä¸­å¿ƒ",
      "personnel_scale": "80äºº",
      "management_info": "CEOã€CTOã€CFO"
    },
    "financial_info": {
      "registered_capital": "1000ä¸‡å…ƒ",
      "annual_revenue": "5000ä¸‡å…ƒ",
      "financing_status": "Aè½®èèµ„2000ä¸‡å…ƒ",
      "listing_status": "æœªä¸Šå¸‚"
    },
    "confidence": 0.85,
    "parsing_version": "mineru-v1.0"
  }
}
```

### 4. æ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢

**æ¥å£**: `GET /api/v1/company/documents/`

**æŸ¥è¯¢å‚æ•°**:
- `company_id`: ä¼ä¸šIDï¼ˆå¯é€‰ï¼‰
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `page_size`: æ¯é¡µå¤§å°ï¼ˆé»˜è®¤10ï¼‰

### 5. æ–‡æ¡£è¯¦æƒ…æŸ¥è¯¢

**æ¥å£**: `GET /api/v1/company/documents/{id}`

### 6. æ–‡æ¡£åˆ é™¤

**æ¥å£**: `DELETE /api/v1/company/documents/{id}`

## ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤1: å¯åŠ¨æœåŠ¡

ç¡®ä¿ä»¥ä¸‹æœåŠ¡æ­£åœ¨è¿è¡Œï¼š
- CompanyæœåŠ¡ (ç«¯å£8083)
- MinerUæœåŠ¡ (ç«¯å£8001)
- æ•°æ®åº“æœåŠ¡

```bash
# å¯åŠ¨CompanyæœåŠ¡
cd basic/backend/internal/company-service
go run main.go

# å¯åŠ¨MinerUæœåŠ¡
cd basic/ai-services
docker-compose up -d
```

### æ­¥éª¤2: è·å–è®¤è¯Token

```bash
# ç™»å½•è·å–JWT token
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "your_username",
    "password": "your_password"
  }'
```

### æ­¥éª¤3: ä¸Šä¼ æ–‡æ¡£

```bash
# ä¸Šä¼ PDFæ–‡æ¡£
curl -X POST http://localhost:8083/api/v1/company/documents/upload \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "file=@company_document.pdf" \
  -F "company_id=1" \
  -F "title=ä¼ä¸šä»‹ç»æ–‡æ¡£"
```

### æ­¥éª¤4: è§£ææ–‡æ¡£

```bash
# å¼€å§‹è§£ææ–‡æ¡£
curl -X POST http://localhost:8083/api/v1/company/documents/1/parse \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### æ­¥éª¤5: æŸ¥è¯¢è§£æçŠ¶æ€

```bash
# æŸ¥è¯¢è§£æçŠ¶æ€
curl -X GET http://localhost:8083/api/v1/company/documents/1/parse/status \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## æµ‹è¯•è„šæœ¬

ä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬è¿›è¡ŒåŠŸèƒ½éªŒè¯ï¼š

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./test_pdf_parsing.sh --check

# è¿è¡Œå®Œæ•´æµ‹è¯•
./test_pdf_parsing.sh --test
```

## æ•°æ®åº“è¡¨ç»“æ„

### company_documents è¡¨
å­˜å‚¨ä¸Šä¼ çš„æ–‡æ¡£ä¿¡æ¯ï¼š
- `id`: ä¸»é”®
- `company_id`: ä¼ä¸šID
- `user_id`: ç”¨æˆ·ID
- `title`: æ–‡æ¡£æ ‡é¢˜
- `original_file`: åŸå§‹æ–‡ä»¶è·¯å¾„
- `file_content`: Base64ç¼–ç çš„æ–‡ä»¶å†…å®¹
- `file_type`: æ–‡ä»¶ç±»å‹
- `file_size`: æ–‡ä»¶å¤§å°
- `upload_time`: ä¸Šä¼ æ—¶é—´

### company_parsing_tasks è¡¨
å­˜å‚¨è§£æä»»åŠ¡ä¿¡æ¯ï¼š
- `id`: ä¸»é”®
- `company_id`: ä¼ä¸šID
- `document_id`: æ–‡æ¡£ID
- `user_id`: ç”¨æˆ·ID
- `status`: ä»»åŠ¡çŠ¶æ€ï¼ˆpending/processing/completed/failedï¼‰
- `progress`: è§£æè¿›åº¦ï¼ˆ0-100ï¼‰
- `error_message`: é”™è¯¯ä¿¡æ¯
- `result_data`: è§£æç»“æœJSON
- `mineru_task_id`: MinerUä»»åŠ¡ID

### company_structured_data è¡¨
å­˜å‚¨ç»“æ„åŒ–è§£æç»“æœï¼š
- `id`: ä¸»é”®
- `company_id`: ä¼ä¸šID
- `task_id`: ä»»åŠ¡ID
- `basic_info`: åŸºæœ¬ä¿¡æ¯JSON
- `business_info`: ä¸šåŠ¡ä¿¡æ¯JSON
- `organization_info`: ç»„ç»‡ä¿¡æ¯JSON
- `financial_info`: è´¢åŠ¡ä¿¡æ¯JSON
- `confidence`: è§£æç½®ä¿¡åº¦
- `parsing_version`: è§£æå™¨ç‰ˆæœ¬

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªæˆæƒè®¿é—®
- `403`: æƒé™ä¸è¶³
- `404`: èµ„æºä¸å­˜åœ¨
- `409`: èµ„æºå†²çª
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- `503`: æœåŠ¡ä¸å¯ç”¨

### é”™è¯¯å“åº”ç¤ºä¾‹
```json
{
  "error": "æ–‡æ¡£ä¸Šä¼ å¤±è´¥: ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œä»…æ”¯æŒPDFã€DOCXã€DOCã€TXT"
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶å‘æ§åˆ¶
- MinerUæœåŠ¡æ”¯æŒæœ€å¤§å¹¶å‘è§£æä»»åŠ¡æ•°é…ç½®
- é»˜è®¤æœ€å¤§å¹¶å‘æ•°ä¸º2ï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡è°ƒæ•´

### 2. æ–‡ä»¶å¤§å°é™åˆ¶
- å»ºè®®å•ä¸ªæ–‡æ¡£å¤§å°ä¸è¶…è¿‡50MB
- å¤§æ–‡æ¡£å»ºè®®åˆ†é¡µå¤„ç†

### 3. ç¼“å­˜ç­–ç•¥
- è§£æç»“æœç¼“å­˜åˆ°æ•°æ®åº“
- é¿å…é‡å¤è§£æç›¸åŒæ–‡æ¡£

## ç›‘æ§å’Œæ—¥å¿—

### 1. æœåŠ¡ç›‘æ§
- ä½¿ç”¨Prometheusç›‘æ§æœåŠ¡çŠ¶æ€
- ç›‘æ§è§£æä»»åŠ¡é˜Ÿåˆ—é•¿åº¦
- ç›‘æ§è§£ææˆåŠŸç‡

### 2. æ—¥å¿—è®°å½•
- è®°å½•æ–‡æ¡£ä¸Šä¼ ã€è§£æã€çŠ¶æ€å˜æ›´
- è®°å½•é”™è¯¯ä¿¡æ¯å’Œå¼‚å¸¸å †æ ˆ
- æ”¯æŒç»“æ„åŒ–æ—¥å¿—è¾“å‡º

## å®‰å…¨è€ƒè™‘

### 1. æ–‡ä»¶å®‰å…¨
- æ–‡ä»¶ç±»å‹éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶
- æ¶æ„æ–‡ä»¶æ£€æµ‹

### 2. è®¿é—®æ§åˆ¶
- JWT tokenéªŒè¯
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- ç”¨æˆ·æ•°æ®éš”ç¦»

### 3. æ•°æ®ä¿æŠ¤
- æ•æ„Ÿä¿¡æ¯è„±æ•
- æ•°æ®åŠ å¯†å­˜å‚¨
- è®¿é—®æ—¥å¿—è®°å½•

## æ•…éšœæ’é™¤

### 1. æœåŠ¡ä¸å¯ç”¨
- æ£€æŸ¥æœåŠ¡ç«¯å£æ˜¯å¦è¢«å ç”¨
- æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
- æ£€æŸ¥MinerUæœåŠ¡æ˜¯å¦å¯åŠ¨

### 2. è§£æå¤±è´¥
- æ£€æŸ¥æ–‡æ¡£æ ¼å¼æ˜¯å¦æ”¯æŒ
- æ£€æŸ¥æ–‡æ¡£å†…å®¹æ˜¯å¦å¯è¯»
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯

### 3. æƒé™é—®é¢˜
- æ£€æŸ¥JWT tokenæ˜¯å¦æœ‰æ•ˆ
- æ£€æŸ¥ç”¨æˆ·è§’è‰²æƒé™
- æ£€æŸ¥èµ„æºè®¿é—®æƒé™

## æ‰©å±•åŠŸèƒ½

### 1. æ‰¹é‡å¤„ç†
- æ”¯æŒæ‰¹é‡ä¸Šä¼ æ–‡æ¡£
- æ”¯æŒæ‰¹é‡è§£æä»»åŠ¡
- æ”¯æŒæ‰¹é‡çŠ¶æ€æŸ¥è¯¢

### 2. æ¨¡æ¿åŒ¹é…
- æ”¯æŒè‡ªå®šä¹‰è§£ææ¨¡æ¿
- æ”¯æŒè¡Œä¸šç‰¹å®šè§£æè§„åˆ™
- æ”¯æŒå¤šè¯­è¨€æ–‡æ¡£è§£æ

### 3. æ™ºèƒ½åˆ†æ
- é›†æˆAIæ¨¡å‹è¿›è¡Œå†…å®¹åˆ†æ
- æä¾›ä¸šåŠ¡æ´å¯Ÿå’Œå»ºè®®
- æ”¯æŒæ•°æ®å¯è§†åŒ–å±•ç¤º

## è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚
